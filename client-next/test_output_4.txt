
[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90mC:/Users/Antigravity/AiGuardian/client-next[39m

[90mstdout[2m | app/components/UserPropagation.test.tsx[2m > [22m[2mUser Identity Propagation[2m > [22m[2mDebug[2m > [22m[2mloads apiSlice
[22m[39mTest Store Created with Middleware

node.exe : [90mstderr[2m | 
app/components/UserPropagation.test.tsx[2m > 
[22m[2mUser Identity Propagation[2m > 
[22m[2mDebug[2m > [22m[2mloads apiSlice
At C:\nvm4w\nodejs\npx.ps1:29 char:3
+   & $NODE_EXE $NPX_CLI_JS $args
+   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: ( 
   [90mstderr[2m...mloads apiSlice:String)  
   [], RemoteException
    + FullyQualifiedErrorId : NativeCommandEr 
   ror
 
[22m[39mapiSlice Loaded. Endpoints: [
  [32m'getAuthMe'[39m,
  [32m'authLogin'[39m,
  [32m'authLogout'[39m,
  [32m'authSetPassword'[39m,
  [32m'sendChatMessage'[39m,
  [32m'getFeed'[39m,
  [32m'deleteFeed'[39m,
  [32m'uploadFile'[39m,
  [32m'getLiteLLMUserInfo'[39m
]
Middleware: [36m[Function: middleware][39m
Store created successfully. State: {"api":{"qu
eries":{},"mutations":{},"provided":{"tags":{}
,"keys":{}},"subscriptions":{},"config":{"onli
ne":true,"focused":true,"middlewareRegistered"
:false,"refetchOnFocus":false,"refetchOnReconn
ect":false,"refetchOnMountOrArgChange":false,"
keepUnusedDataFor":60,"reducerPath":"api","inv
alidationBehavior":"delayed"}},"user":{"user":
null,"isLoading":false,"error":null}}

[90mstdout[2m | app/components/UserPropagation.test.tsx[2m > [22m[2mUser Identity Propagation[2m > [22m[2mFeedPanel[2m > [22m[2mdirectly triggers fetch via store
[22m[39mTest Store Created with Middleware
Dispatching: api/executeQuery/pending
Dispatching: api/config/middlewareRegistered
[apiSlice] getFeed query called with userId: direct-user
Dispatching: api/subscriptions/internal_getRTKQSubscriptions

[90mstderr[2m | 
app/components/UserPropagation.test.tsx[2m > 
[22m[2mUser Identity Propagation[2m > 
[22m[2mFeedPanel[2m > [22m[2mdirectly 
triggers fetch via store
[22m[39m[apiSlice] baseQuery executing for 
args: {
  url: [32m'/api/proxy/feed'[39m,
  method: [32m'GET'[39m,
  headers: { [32m'X-User-ID'[39m: 
[32m'direct-user'[39m }
}
[apiSlice] prepareHeaders called
[apiSlice] Headers prepared: {
  [32m'x-device-id'[39m: [32m'172b3251-7284
-4c2a-bbbc-a5de4d1c958d'[39m,
  [32m'x-user-id'[39m: 
[32m'direct-user'[39m
}
Fetch called: Request {
  method: [32m'GET'[39m,
  url: 
[32m'http://localhost/api/proxy/feed'[39m,
  headers: Headers {
    [32m'X-User-ID'[39m: 
[32m'direct-user'[39m,
    [32m'X-Device-ID'[39m: [32m'172b3251-72
84-4c2a-bbbc-a5de4d1c958d'[39m,
    accept: [32m'application/json'[39m
  },
  destination: [32m''[39m,
  referrer: [32m'about:client'[39m,
  referrerPolicy: [32m''[39m,
  mode: [32m'cors'[39m,
  credentials: [32m'include'[39m,
  cache: [32m'default'[39m,
  redirect: [32m'follow'[39m,
  integrity: [32m''[39m,
  keepalive: [33mfalse[39m,
  isReloadNavigation: [33mfalse[39m,
  isHistoryNavigation: [33mfalse[39m,
  signal: AbortSignal { aborted: 
[33mfalse[39m }
}
Fetch headers: [90mundefined[39m

[90mstdout[2m | app/components/UserPropagation.test.tsx[2m > [22m[2mUser Identity Propagation[2m > [22m[2mFeedPanel[2m > [22m[2mdirectly triggers fetch via store
[22m[39mDispatching: api/executeQuery/fulfilled

[90mstderr[2m | 
app/components/UserPropagation.test.tsx[2m > 
[22m[2mUser Identity Propagation[2m > 
[22m[2mFeedPanel[2m > [22m[2mdirectly 
triggers fetch via store
[22m[39m[apiSlice] baseQuery result: {
  data: [],
  meta: {
    request: Request {
      method: [32m'GET'[39m,
      url: 
[32m'http://localhost/api/proxy/feed'[39m,
      headers: Headers {
        [32m'X-User-ID'[39m: 
[32m'direct-user'[39m,
        [32m'X-Device-ID'[39m: [32m'172b325
1-7284-4c2a-bbbc-a5de4d1c958d'[39m,
        accept: [32m'application/json'[39m
      },
      destination: [32m''[39m,
      referrer: [32m'about:client'[39m,
      referrerPolicy: [32m''[39m,
      mode: [32m'cors'[39m,
      credentials: [32m'include'[39m,
      cache: [32m'default'[39m,
      redirect: [32m'follow'[39m,
      integrity: [32m''[39m,
      keepalive: [33mfalse[39m,
      isReloadNavigation: [33mfalse[39m,
      isHistoryNavigation: [33mfalse[39m,
      signal: AbortSignal { aborted: 
[33mfalse[39m }
    },
    response: Response {
      status: [33m200[39m,
      statusText: [32m''[39m,
      headers: Headers { 
[32m'Content-Type'[39m: 
[32m'application/json'[39m },
      body: ReadableStream { locked: 
[33mtrue[39m, state: [32m'closed'[39m, 
supportsBYOB: [33mtrue[39m },
      bodyUsed: [33mtrue[39m,
      ok: [33mtrue[39m,
      redirected: [33mfalse[39m,
      type: [32m'default'[39m,
      url: [32m''[39m
    }
  }
}

[90mstdout[2m | app/components/UserPropagation.test.tsx[2m > [22m[2mUser Identity Propagation[2m > [22m[2mFeedPanel[2m > [22m[2mprioritizes userId prop over localStorage
[22m[39mTest Store Created with Middleware
Dispatching: api/subscriptions/internal_getRTKQSubscriptions
Dispatching: api/config/middlewareRegistered
Dispatching: api/executeQuery/pending
[apiSlice] getFeed query called with userId: prop-user

[90mstderr[2m | 
app/components/UserPropagation.test.tsx[2m > 
[22m[2mUser Identity Propagation[2m > 
[22m[2mFeedPanel[2m > [22m[2mprioritizes 
userId prop over localStorage
[22m[39m[FeedPanel] usage: effectiveUserId: 
prop-user useMock: [33mfalse[39m NODE_ENV: 
test
[FeedPanel] feedData: [90mundefined[39m
[apiSlice] baseQuery executing for args: {
  url: [32m'/api/proxy/feed'[39m,
  method: [32m'GET'[39m,
  headers: { [32m'X-User-ID'[39m: 
[32m'prop-user'[39m }
}
[apiSlice] prepareHeaders called
[apiSlice] Headers prepared: {
  [32m'x-device-id'[39m: [32m'1551ea4c-7cd3
-42ff-93f3-3706d3a4be8e'[39m,
  [32m'x-user-id'[39m: 
[32m'stored-user'[39m
}
[FeedPanel] usage: effectiveUserId: prop-user 
useMock: [33mfalse[39m NODE_ENV: test
[FeedPanel] feedData: [90mundefined[39m
Fetch called: Request {
  method: [32m'GET'[39m,
  url: 
[32m'http://localhost/api/proxy/feed'[39m,
  headers: Headers {
    [32m'X-User-ID'[39m: 
[32m'stored-user'[39m,
    [32m'X-Device-ID'[39m: [32m'1551ea4c-7c
d3-42ff-93f3-3706d3a4be8e'[39m,
    accept: [32m'application/json'[39m
  },
  destination: [32m''[39m,
  referrer: [32m'about:client'[39m,
  referrerPolicy: [32m''[39m,
  mode: [32m'cors'[39m,
  credentials: [32m'include'[39m,
  cache: [32m'default'[39m,
  redirect: [32m'follow'[39m,
  integrity: [32m''[39m,
  keepalive: [33mfalse[39m,
  isReloadNavigation: [33mfalse[39m,
  isHistoryNavigation: [33mfalse[39m,
  signal: AbortSignal { aborted: 
[33mfalse[39m }
}
Fetch headers: [90mundefined[39m

[90mstderr[2m | 
app/components/UserPropagation.test.tsx[2m > 
[22m[2mUser Identity Propagation[2m > 
[22m[2mFeedPanel[2m > [22m[2mprioritizes 
userId prop over localStorage
[22m[39m[apiSlice] baseQuery result: {
  data: [],
  meta: {
    request: Request {
      method: [32m'GET'[39m,
      url: 
[32m'http://localhost/api/proxy/feed'[39m,
      headers: Headers {
        [32m'X-User-ID'[39m: 
[32m'stored-user'[39m,
        [32m'X-Device-ID'[39m: [32m'1551ea4
c-7cd3-42ff-93f3-3706d3a4be8e'[39m,
        accept: [32m'application/json'[39m
      },
      destination: [32m''[39m,
      referrer: [32m'about:client'[39m,
      referrerPolicy: [32m''[39m,
      mode: [32m'cors'[39m,
      credentials: [32m'include'[39m,
      cache: [32m'default'[39m,
      redirect: [32m'follow'[39m,
      integrity: [32m''[39m,
      keepalive: [33mfalse[39m,
      isReloadNavigation: [33mfalse[39m,
      isHistoryNavigation: [33mfalse[39m,
      signal: AbortSignal { aborted: 
[33mfalse[39m }
    },
    response: Response {
      status: [33m200[39m,
      statusText: [32m''[39m,
      headers: Headers { 
[32m'Content-Type'[39m: 
[32m'application/json'[39m },
      body: ReadableStream { locked: 
[33mtrue[39m, state: [32m'closed'[39m, 
supportsBYOB: [33mtrue[39m },
      bodyUsed: [33mtrue[39m,
      ok: [33mtrue[39m,
      redirected: [33mfalse[39m,
      type: [32m'default'[39m,
      url: [32m''[39m
    }
  }
}

[90mstdout[2m | app/components/UserPropagation.test.tsx[2m > [22m[2mUser Identity Propagation[2m > [22m[2mFeedPanel[2m > [22m[2mprioritizes userId prop over localStorage
[22m[39mDispatching: api/executeQuery/fulfilled

[90mstderr[2m | 
app/components/UserPropagation.test.tsx[2m > 
[22m[2mUser Identity Propagation[2m > 
[22m[2mFeedPanel[2m > [22m[2mprioritizes 
userId prop over localStorage
[22m[39m[FeedPanel] usage: effectiveUserId: 
prop-user useMock: [33mfalse[39m NODE_ENV: 
test
[FeedPanel] feedData: []

[90mstdout[2m | app/components/UserPropagation.test.tsx[2m > [22m[2mUser Identity Propagation[2m > [22m[2mFeedPanel[2m > [22m[2mprioritizes userId prop over localStorage
[22m[39mFeed data received from RTK Query: []

[90mstderr[2m | 
app/components/UserPropagation.test.tsx[2m > 
[22m[2mUser Identity Propagation[2m > 
[22m[2mFeedPanel[2m > [22m[2mprioritizes 
userId prop over localStorage
[22m[39m[FeedPanel] usage: effectiveUserId: 
prop-user useMock: [33mfalse[39m NODE_ENV: 
test
[FeedPanel] feedData: []

[90mstdout[2m | app/components/UserPropagation.test.tsx[2m > [22m[2mUser Identity Propagation[2m > [22m[2mFeedPanel[2m > [22m[2mprioritizes userId prop over localStorage
[22m[39mDispatching: api/subscriptions/unsubscribeQueryResult

[90mstdout[2m | app/components/UserPropagation.test.tsx[2m > [22m[2mUser Identity Propagation[2m > [22m[2mFeedPanel[2m > [22m[2mfalls back to localStorage if prop is missing
[22m[39mTest Store Created with Middleware
Dispatching: api/subscriptions/internal_getRTKQSubscriptions
Dispatching: api/config/middlewareRegistered
Dispatching: api/executeQuery/pending
[apiSlice] getFeed query called with userId: stored-user

[90mstderr[2m | 
app/components/UserPropagation.test.tsx[2m > 
[22m[2mUser Identity Propagation[2m > 
[22m[2mFeedPanel[2m > [22m[2mfalls back 
to localStorage if prop is missing
[22m[39m[FeedPanel] usage: effectiveUserId: 
stored-user useMock: [33mfalse[39m 
NODE_ENV: test
[FeedPanel] feedData: [90mundefined[39m
[apiSlice] baseQuery executing for args: {
  url: [32m'/api/proxy/feed'[39m,
  method: [32m'GET'[39m,
  headers: { [32m'X-User-ID'[39m: 
[32m'stored-user'[39m }
}
[apiSlice] prepareHeaders called
[apiSlice] Headers prepared: {
  [32m'x-device-id'[39m: [32m'90dc6124-bb5e
-4ad3-9743-6a8fbd443426'[39m,
  [32m'x-user-id'[39m: 
[32m'stored-user'[39m
}
[FeedPanel] usage: effectiveUserId: 
stored-user useMock: [33mfalse[39m 
NODE_ENV: test
[FeedPanel] feedData: [90mundefined[39m
Fetch called: Request {
  method: [32m'GET'[39m,
  url: 
[32m'http://localhost/api/proxy/feed'[39m,
  headers: Headers {
    [32m'X-User-ID'[39m: 
[32m'stored-user'[39m,
    [32m'X-Device-ID'[39m: [32m'90dc6124-bb
5e-4ad3-9743-6a8fbd443426'[39m,
    accept: [32m'application/json'[39m
  },
  destination: [32m''[39m,
  referrer: [32m'about:client'[39m,
  referrerPolicy: [32m''[39m,
  mode: [32m'cors'[39m,
  credentials: [32m'include'[39m,
  cache: [32m'default'[39m,
  redirect: [32m'follow'[39m,
  integrity: [32m''[39m,
  keepalive: [33mfalse[39m,
  isReloadNavigation: [33mfalse[39m,
  isHistoryNavigation: [33mfalse[39m,
  signal: AbortSignal { aborted: 
[33mfalse[39m }
}
Fetch headers: [90mundefined[39m

[90mstderr[2m | 
app/components/UserPropagation.test.tsx[2m > 
[22m[2mUser Identity Propagation[2m > 
[22m[2mFeedPanel[2m > [22m[2mfalls back 
to localStorage if prop is missing
[22m[39m[apiSlice] baseQuery result: {
  data: [],
  meta: {
    request: Request {
      method: [32m'GET'[39m,
      url: 
[32m'http://localhost/api/proxy/feed'[39m,
      headers: Headers {
        [32m'X-User-ID'[39m: 
[32m'stored-user'[39m,
        [32m'X-Device-ID'[39m: [32m'90dc612
4-bb5e-4ad3-9743-6a8fbd443426'[39m,
        accept: [32m'application/json'[39m
      },
      destination: [32m''[39m,
      referrer: [32m'about:client'[39m,
      referrerPolicy: [32m''[39m,
      mode: [32m'cors'[39m,
      credentials: [32m'include'[39m,
      cache: [32m'default'[39m,
      redirect: [32m'follow'[39m,
      integrity: [32m''[39m,
      keepalive: [33mfalse[39m,
      isReloadNavigation: [33mfalse[39m,
      isHistoryNavigation: [33mfalse[39m,
      signal: AbortSignal { aborted: 
[33mfalse[39m }
    },
    response: Response {
      status: [33m200[39m,
      statusText: [32m''[39m,
      headers: Headers { 
[32m'Content-Type'[39m: 
[32m'application/json'[39m },
      body: ReadableStream { locked: 
[33mtrue[39m, state: [32m'closed'[39m, 
supportsBYOB: [33mtrue[39m },
      bodyUsed: [33mtrue[39m,
      ok: [33mtrue[39m,
      redirected: [33mfalse[39m,
      type: [32m'default'[39m,
      url: [32m''[39m
    }
  }
}

[90mstdout[2m | app/components/UserPropagation.test.tsx[2m > [22m[2mUser Identity Propagation[2m > [22m[2mFeedPanel[2m > [22m[2mfalls back to localStorage if prop is missing
[22m[39mDispatching: api/executeQuery/fulfilled

[90mstdout[2m | app/components/UserPropagation.test.tsx[2m > [22m[2mUser Identity Propagation[2m > [22m[2mFeedPanel[2m > [22m[2mfalls back to localStorage if prop is missing
[22m[39mFeed data received from RTK Query: []

[90mstderr[2m | 
app/components/UserPropagation.test.tsx[2m > 
[22m[2mUser Identity Propagation[2m > 
[22m[2mFeedPanel[2m > [22m[2mfalls back 
to localStorage if prop is missing
[22m[39m[FeedPanel] usage: effectiveUserId: 
stored-user useMock: [33mfalse[39m 
NODE_ENV: test
[FeedPanel] feedData: []

[90mstderr[2m | 
app/components/UserPropagation.test.tsx[2m > 
[22m[2mUser Identity Propagation[2m > 
[22m[2mFeedPanel[2m > [22m[2mfalls back 
to localStorage if prop is missing
[22m[39m[FeedPanel] usage: effectiveUserId: 
stored-user useMock: [33mfalse[39m 
NODE_ENV: test
[FeedPanel] feedData: []

[90mstdout[2m | app/components/UserPropagation.test.tsx[2m > [22m[2mUser Identity Propagation[2m > [22m[2mFeedPanel[2m > [22m[2mfalls back to localStorage if prop is missing
[22m[39mDispatching: api/subscriptions/unsubscribeQueryResult

[90mstdout[2m | app/components/UserPropagation.test.tsx[2m > [22m[2mUser Identity Propagation[2m > [22m[2mFeedPanel[2m > [22m[2muses empty string if neither are present
[22m[39mTest Store Created with Middleware
Dispatching: api/subscriptions/internal_getRTKQSubscriptions
Dispatching: api/config/middlewareRegistered
Dispatching: api/executeQuery/pending
[apiSlice] getFeed query called with userId: [90mundefined[39m

[90mstderr[2m | 
app/components/UserPropagation.test.tsx[2m > 
[22m[2mUser Identity Propagation[2m > 
[22m[2mFeedPanel[2m > [22m[2muses empty 
string if neither are present
[22m[39m[FeedPanel] usage: effectiveUserId: 
 useMock: [33mfalse[39m NODE_ENV: test
[FeedPanel] feedData: [90mundefined[39m
[apiSlice] baseQuery executing for args: { 
url: [32m'/api/proxy/feed'[39m, method: 
[32m'GET'[39m, headers: {} }
[apiSlice] prepareHeaders called
[apiSlice] Headers prepared: { 
[32m'x-device-id'[39m: [32m'a8192e26-6a23-4
a16-9e36-6401a22a5912'[39m }
[FeedPanel] usage: effectiveUserId:  useMock: 
[33mfalse[39m NODE_ENV: test
[FeedPanel] feedData: [90mundefined[39m
Fetch called: Request {
  method: [32m'GET'[39m,
  url: 
[32m'http://localhost/api/proxy/feed'[39m,
  headers: Headers {
    [32m'X-Device-ID'[39m: [32m'a8192e26-6a
23-4a16-9e36-6401a22a5912'[39m,
    accept: [32m'application/json'[39m
  },
  destination: [32m''[39m,
  referrer: [32m'about:client'[39m,
  referrerPolicy: [32m''[39m,
  mode: [32m'cors'[39m,
  credentials: [32m'include'[39m,
  cache: [32m'default'[39m,
  redirect: [32m'follow'[39m,
  integrity: [32m''[39m,
  keepalive: [33mfalse[39m,
  isReloadNavigation: [33mfalse[39m,
  isHistoryNavigation: [33mfalse[39m,
  signal: AbortSignal { aborted: 
[33mfalse[39m }
}
Fetch headers: [90mundefined[39m

[90mstderr[2m | 
app/components/UserPropagation.test.tsx[2m > 
[22m[2mUser Identity Propagation[2m > 
[22m[2mFeedPanel[2m > [22m[2muses empty 
string if neither are present
[22m[39m[apiSlice] baseQuery result: {
  data: [],
  meta: {
    request: Request {
      method: [32m'GET'[39m,
      url: 
[32m'http://localhost/api/proxy/feed'[39m,
      headers: Headers {
        [32m'X-Device-ID'[39m: [32m'a8192e2
6-6a23-4a16-9e36-6401a22a5912'[39m,
        accept: [32m'application/json'[39m
      },
      destination: [32m''[39m,
      referrer: [32m'about:client'[39m,
      referrerPolicy: [32m''[39m,
      mode: [32m'cors'[39m,
      credentials: [32m'include'[39m,
      cache: [32m'default'[39m,
      redirect: [32m'follow'[39m,
      integrity: [32m''[39m,
      keepalive: [33mfalse[39m,
      isReloadNavigation: [33mfalse[39m,
      isHistoryNavigation: [33mfalse[39m,
      signal: AbortSignal { aborted: 
[33mfalse[39m }
    },
    response: Response {
      status: [33m200[39m,
      statusText: [32m''[39m,
      headers: Headers { 
[32m'Content-Type'[39m: 
[32m'application/json'[39m },
      body: ReadableStream { locked: 
[33mtrue[39m, state: [32m'closed'[39m, 
supportsBYOB: [33mtrue[39m },
      bodyUsed: [33mtrue[39m,
      ok: [33mtrue[39m,
      redirected: [33mfalse[39m,
      type: [32m'default'[39m,
      url: [32m''[39m
    }
  }
}

[90mstdout[2m | app/components/UserPropagation.test.tsx[2m > [22m[2mUser Identity Propagation[2m > [22m[2mFeedPanel[2m > [22m[2muses empty string if neither are present
[22m[39mDispatching: api/executeQuery/fulfilled

[90mstdout[2m | app/components/UserPropagation.test.tsx[2m > [22m[2mUser Identity Propagation[2m > [22m[2mFeedPanel[2m > [22m[2muses empty string if neither are present
[22m[39mFeed data received from RTK Query: []

[90mstderr[2m | 
app/components/UserPropagation.test.tsx[2m > 
[22m[2mUser Identity Propagation[2m > 
[22m[2mFeedPanel[2m > [22m[2muses empty 
string if neither are present
[22m[39m[FeedPanel] usage: effectiveUserId: 
 useMock: [33mfalse[39m NODE_ENV: test
[FeedPanel] feedData: []

[90mstderr[2m | 
app/components/UserPropagation.test.tsx[2m > 
[22m[2mUser Identity Propagation[2m > 
[22m[2mFeedPanel[2m > [22m[2muses empty 
string if neither are present
[22m[39m[FeedPanel] usage: effectiveUserId: 
 useMock: [33mfalse[39m NODE_ENV: test
[FeedPanel] feedData: []

[90mstdout[2m | app/components/UserPropagation.test.tsx[2m > [22m[2mUser Identity Propagation[2m > [22m[2mFeedPanel[2m > [22m[2muses empty string if neither are present
[22m[39mDispatching: api/subscriptions/unsubscribeQueryResult

[90mstdout[2m | app/components/UserPropagation.test.tsx[2m > [22m[2mUser Identity Propagation[2m > [22m[2mChatPanel[2m > [22m[2muses userId prop in headers
[22m[39mTest Store Created with Middleware

 [31m❯[39m app/components/UserPropagation.test.tsx [2m([22m[2m6 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 1247[2mms[22m[39m
       [32m✓[39m loads apiSlice[32m 8[2mms[22m[39m
       [32m✓[39m directly triggers fetch via store[32m 44[2mms[22m[39m
[31m       [31m×[31m prioritizes userId prop over localStorage[39m[33m 1048[2mms[22m[39m
       [32m✓[39m falls back to localStorage if prop is missing[32m 42[2mms[22m[39m
       [32m✓[39m uses empty string if neither are present[32m 45[2mms[22m[39m
[31m       [31m×[31m uses userId prop in headers[39m[32m 58[2mms[22m[39m

[31m⎯⎯⎯⎯⎯⎯⎯[39m[1m[41m Failed Tests 2 
[49m[22m[31m⎯⎯⎯⎯⎯⎯⎯[39m

[41m[1m FAIL [22m[49m 
app/components/UserPropagation.test.tsx[2m > 
[22mUser Identity Propagation[2m > 
[22mFeedPanel[2m > [22mprioritizes userId 
prop over localStorage
[31m[1mAssertionError[22m: expected 
'stored-user' to be 'prop-user' // Object.is 
equality

Ignored nodes: comments, script, style
[36m<html>[31m
  [36m<head />[31m
  [36m<body>[31m
    [36m<div>[31m
      [36m<div[31m
        [33mclass[31m=[32m"flex-1 flex 
flex-col overflow-y-auto h-full 
scrollbar-thin scrollbar-thumb-[#9DBEF8] 
scrollbar-track-transparent"[31m
      [36m>[31m
        [36m<div[31m
          [33mclass[31m=[32m"sticky top-0 
z-10 p-4 mb-2 border-b border-[#9DBEF8]/30 
flex justify-between items-center 
bg-white"[31m
        [36m>[31m
          [36m<div>[31m
            [36m<h2[31m
              [33mclass[31m=[32m"text-xl 
font-bold text-[#003580] tracking-tight"[31m
            [36m>[31m
              [0mInsight Stream[0m
            [36m</h2>[31m
          [36m</div>[31m
          [36m<div[31m
            [33mclass[31m=[32m"flex 
items-center gap-2"[31m
          [36m>[31m
            [36m<button[31m
              
[33mclass[31m=[32m"text-[10px] px-3 py-1.5 
rounded-full font-medium transition-all 
duration-300 border bg-[#EEF5FF] 
text-[#003580] border-[#9DBEF8] 
hover:bg-white hover:shadow-sm"[31m
            [36m>[31m
              [0mDebug[0m
            [36m</button>[31m
            [36m<div>[31m
              [0mMockUserMenuInline[0m
            [36m</div>[31m
          [36m</div>[31m
        [36m</div>[31m
        [36m<div[31m
          [33mclass[31m=[32m"space-y-4 
px-4 pb-20"[31m
        [36m>[31m
          [36m<div[31m
            [33mclass[31m=[32m"text-center 
text-[#003580]/40 py-12 italic text-sm"[31m
          [36m>[31m
            [0mQuiet... for now.[0m
          [36m</div>[31m
        [36m</div>[31m
      [36m</div>[31m
    [36m</div>[31m
  [36m</body>[31m
[36m</html>[31m[39m

Expected: [32m"[7mprop[27m-user"[39m
Received: [31m"[7mstored[27m-user"[39m

[36m [2m❯[22m app/components/UserPropagatio
n.test.tsx:[2m139:58[22m[39m
    [90m137| [39m                const 
request = 
vi.mocked(global.fetch).mock.calls[0][…
    [90m138| [39m                [34mexpect
[39m(request[33m.[39murl)[33m.[39m[34mto
Contain[39m([32m'/api/proxy/feed'[39m)[33m
;[39m
    [90m139| [39m                expect(requ
est.headers.get('X-User-ID')).toBe('prop-us…
    [90m   | [39m                           
                              [31m^[39m
    [90m140| [39m            })[33m;[39m
    [90m141| [39m        })[33m;[39m
[90m [2m❯[22m 
runWithExpensiveErrorDiagnosticsDisabled node_
modules/@testing-library/dom/dist/config.js:[
2m47:12[22m[39m
[90m [2m❯[22m checkCallback node_modules/@t
esting-library/dom/dist/wait-for.js:[2m124:77
[22m[39m
[90m [2m❯[22m 
Timeout.checkRealTimersCallback node_modules/@
testing-library/dom/dist/wait-for.js:[2m118:1
6[22m[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/2]⎯[22m[
39m

[41m[1m FAIL [22m[49m 
app/components/UserPropagation.test.tsx[2m > 
[22mUser Identity Propagation[2m > 
[22mChatPanel[2m > [22muses userId prop in 
headers
[31m[1mTypeError[22m: 
messagesEndRef.current?.scrollIntoView is not 
a function[39m
[36m [2m❯[22m scrollToBottom app/components
/ChatPanel.tsx:[2m71:33[22m[39m
    [90m 69| [39m
    [90m 70| [39m    [35mconst[39m 
scrollToBottom [33m=[39m () [33m=>[39m {
    [90m 71| [39m        messagesEndRef[33m
.[39mcurrent[33m?.[39m[34mscrollIntoView[
39m({ behavior[33m:[39m [32m"smooth"[39m 
})[33m;[39m
    [90m   | [39m                           
     [31m^[39m
    [90m 72| [39m    }[33m;[39m
    [90m 73| [39m
[90m [2m❯[22m app/components/ChatPanel.tsx:
[2m75:9[22m[39m
[90m [2m❯[22m 
Object.react_stack_bottom_frame node_modules/r
eact-dom/cjs/react-dom-client.development.js:
[2m25989:20[22m[39m
[90m [2m❯[22m runWithFiberInDEV node_module
s/react-dom/cjs/react-dom-client.development.j
s:[2m874:13[22m[39m
[90m [2m❯[22m commitHookEffectListMount nod
e_modules/react-dom/cjs/react-dom-client.devel
opment.js:[2m13249:29[22m[39m
[90m [2m❯[22m 
commitHookPassiveMountEffects node_modules/rea
ct-dom/cjs/react-dom-client.development.js:[2
m13336:11[22m[39m
[90m [2m❯[22m commitPassiveMountOnFiber nod
e_modules/react-dom/cjs/react-dom-client.devel
opment.js:[2m15484:13[22m[39m
[90m [2m❯[22m 
recursivelyTraversePassiveMountEffects node_mo
dules/react-dom/cjs/react-dom-client.developme
nt.js:[2m15439:11[22m[39m
[90m [2m❯[22m commitPassiveMountOnFiber nod
e_modules/react-dom/cjs/react-dom-client.devel
opment.js:[2m15718:11[22m[39m
[90m [2m❯[22m 
recursivelyTraversePassiveMountEffects node_mo
dules/react-dom/cjs/react-dom-client.developme
nt.js:[2m15439:11[22m[39m

[31m[2m⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/2]⎯[22m[
39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (6)[39m
[2m   Start at [22m 11:12:46
[2m   Duration [22m 3.97s[2m (transform 325ms, setup 0ms, import 1.27s, tests 1.25s, environment 1.20s)[22m

